# Dev Log: Streamlit UI & Report Structure

**Version:** v0.3
**Date:** 2026-02-26

## What Happened in This Session

### Task 1: Build Streamlit Web Interface
**Question:** Build a Streamlit UI for live demo — the core v0.3 deliverable.
**Solution:** Created `streamlit_app.py` with sidebar inputs (scenario picker + custom fields), step-by-step progress tracking via `st.status()`, timing metric cards, tabbed report/queries view, and markdown download button. Created `.streamlit/config.toml` for dark theme.
**Decision:** Call individual pipeline functions (`plan_searches`, `conduct_research`, `analyze_compliance`) instead of `run_analysis()` — enables per-step progress feedback. Still calls `save_report()` and `append_test_log()` after completion.
**Files modified:** `streamlit_app.py` (new), `.streamlit/config.toml` (new)

### Task 2: Investigated Windows GBK Encoding Error (Bug #17)
**Question:** Streamlit crashed with `UnicodeEncodeError: 'gbk' codec can't encode character` on emoji print statements — but only when the Cursor AI agent ran the command.
**Investigation:** AI agent proposed a fix (`sys.stdout.reconfigure`). User tested running Streamlit from their own PowerShell terminal — worked fine, no error.
**Decision:** User pushed back. This is a Cursor IDE shell environment quirk, not a code bug. No fix applied. Closed as "not a code bug."
**Files modified:** None

### Task 3: Industry Category Clarification
**Question:** User asked what industry category their tool falls under — not law, since they're building a tool, not practicing law.
**Answer:** RegTech (Regulatory Technology) / AI Compliance SaaS. Added as the `regtech` test scenario.
**Files modified:** `agent.py` (added `regtech` to `TEST_SCENARIOS`)

### Task 4: Risk Prioritization Matrix as Fixed Report Section
**Question:** User liked the Risk Prioritization Matrix and wanted it as the first thing users see in every report.
**Solution:** Rewrote `ANALYSIS_PROMPT` in `prompts.py`. Matrix is mandatory first section with locked format (Gap | Risk Level | Regulatory Impact | Implementation Difficulty | Priority). Rest of report structure is flexible — Claude can add sections as warranted.
**Decision:** User explicitly chose flexible structure over strict template — wants to spend time on structure in a future version. Strict template was tried and reverted (made reports too thin).
**Files modified:** `prompts.py` (rewrote `ANALYSIS_PROMPT`)

### Task 5: Reviewed All Existing Report Structures
**Question:** Summarize the best report structure across all 6 existing reports.
**Answer:** Core 4 sections appear in 100% of reports (Regulations, Risks, Gaps, Recommendations). Matrix appeared in 67%. Bonus sections (cost estimates, vendor-specific, regulatory outlook) appear when the scenario warrants it. Documented the pattern for future prompt refinement.

### Task 6: Waiting UX Improvements
**Question:** Analysis takes 2–3 minutes and the UI looks jammed during the wait.
**Solution:** Three improvements: (1) Live JS elapsed timer via `components.html()` — runs in browser independently of Python blocking. (2) "This usually takes 2–3 minutes" hint. (3) Step progress counter in status label ("step 1/3" → "step 2/3" → "step 3/3"). Timer stops and shows "Report generated in X:XX" when done.
**Files modified:** `streamlit_app.py`

### Task 7: Timer Font Color Fix
**Question:** Timer text was black on the dark theme background.
**Solution:** Changed `color:inherit` to `color:#FAFAFA` — iframe can't inherit from parent page.
**Files modified:** `streamlit_app.py`

### Task 8: Reverted Conciseness Constraint
**Question:** Added "keep report concise, top 5-7 gaps" instruction to prompt — reports became too thin.
**Decision:** User reverted the change. Thorough 3-minute reports preferred over fast thin ones. Updated timer hint from "2 minutes" to "2–3 minutes".
**Files modified:** `prompts.py` (user reverted), `streamlit_app.py` (timer hint updated)

### Task 9: Bug #17 Documentation Correction
**Question:** User flagged that bug #17 (GBK encoding) was documented as "fixed" but the fix was never intended — it's not a code bug, only occurs in Cursor's shell runner.
**Decision:** Reverted the fix (removed `sys.stdout.reconfigure` from `agent.py`). Updated all documentation (iteration doc, changelog, dev log) to accurately reflect: investigated, user pushed back, closed as Cursor environment quirk, no fix applied.
**Files modified:** `agent.py` (reverted), `docs/iterations/v0.3-streamlit-ui.md`, `CHANGELOG.md`, this dev log

### Task 10: Final Documentation Sync
**Question:** User asked to recheck all docs for consistency.
**Findings:** 5 inconsistencies found — CHANGELOG summary still said "Fixed", iteration doc goal/source-chats/version-log still said "fix", README had duplicate usage block. All corrected.
**Files modified:** `CHANGELOG.md`, `docs/iterations/v0.3-streamlit-ui.md`, `README.md`, this dev log

## Key Decisions Made
1. RegTech / AI Compliance SaaS is the project's industry category
2. Risk Prioritization Matrix is mandatory first section; rest of report structure stays flexible for now
3. Report thoroughness > speed — accept 2–3 minute analysis time for comprehensive output
4. Call individual pipeline functions in Streamlit (not `run_analysis()`) for per-step progress
5. Use client-side JS timer (not Python timer) since Streamlit blocks during API calls
6. Bug #17 (GBK encoding) is NOT a code bug — it's a Cursor IDE environment issue. No fix applied.

## Related Files
- Iteration doc: [docs/iterations/v0.3-streamlit-ui.md](../iterations/v0.3-streamlit-ui.md)
- CHANGELOG: [CHANGELOG.md](../../CHANGELOG.md)
- Test reports: `reports/report_v0.3_*.md` (4 reports)
