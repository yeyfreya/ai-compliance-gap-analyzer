# Dev Log: v0.2 Bug Fixes & Hardening

**Version:** v0.2
**Date:** 2026-02-26

## What Happened in This Session

### Task 1: Fix "Fix Now" Bugs
**Question:** Fix the three live bugs from v0.1 baseline (format_search_results type mismatch, indentation, max_tokens truncation)
**Solution:**
- Bug #1: Fixed `format_search_results()` in `tools.py` — was treating a list as a dict, silently dropping all research data. Now iterates the list directly.
- Bug #2: Closed — indentation already fixed in prior session.
- Bug #15: Increased `max_tokens` from 3000 to 8000 in `analyze_compliance()` — v0.1 test confirmed report was truncating mid-table.
**Files modified:** `tools.py` (lines 76-89), `agent.py` (line 123)

### Task 2: Fix High Priority Bugs (Error Handling & Validation)
**Question:** Should we fix remaining bugs or pivot to Streamlit? User wants to launch a demo ASAP.
**Decision:** Fix Bugs #3, #4, #6 in the core (`agent.py`) before building UI — because the user plans to swap frontends later (Streamlit → web app → OpenClaw plugin). Errors handled in the core are frontend-agnostic.
**Solution:**
- Bug #3: Wrapped both Claude API calls in `try/except anthropic.APIError`. `plan_searches()` falls through to fallback queries. `analyze_compliance()` returns an error string that gets saved in the report.
- Bug #4: Added input validation at top of `run_analysis()` — rejects empty/whitespace/overlength inputs with `{"error": "..."}` dict. No API calls on invalid input.
- Bug #6: Closed — bare `except` already fixed in prior session (catches specific exceptions).
**Files modified:** `agent.py` (lines 39-54, 121-135, 198-203)

### Task 3: Defer Remaining Bugs
**Question:** What about Medium and Low priority bugs?
**Decision:** Defer all Medium (#9, #10, #7, #11) and Low (#5, #8, #12, #13, #14) bugs to post-launch. Core pipeline is now correct and hardened for a demo.

## Key Decisions Made
1. Fixed the receiver (`format_search_results`) not the caller — cleaner separation of concerns
2. Error handling goes in the core layer (`agent.py`), not the UI — makes the code frontend-agnostic for future pivots (Streamlit → web app → OpenClaw)
3. Input validation returns error dicts, not exceptions — any frontend can check `if "error" in result:`
4. Medium/Low bugs deferred to prioritize Streamlit demo launch

## Related Files
- Iteration doc: [docs/iterations/v0.2-bug-fixes-and-observability.md](../iterations/v0.2-bug-fixes-and-observability.md)
- Previous version: [docs/iterations/v0.1-baseline.md](../iterations/v0.1-baseline.md)
- Changelog: [CHANGELOG.md](../../CHANGELOG.md)
