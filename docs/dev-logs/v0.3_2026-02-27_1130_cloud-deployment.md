# Dev Log: Streamlit Cloud Deployment

**Version:** v0.3
**Date:** 2026-02-27

## What Happened in This Session

### Task 1: Streamlit Cloud Secrets Support
**Question:** Deploy the app to Streamlit Cloud for a live public demo.
**Problem:** `agent.py` and `tools.py` create API clients at module level using `os.getenv()`. On Streamlit Cloud, secrets are in `st.secrets`, not environment variables. The app would crash on import.
**Solution:** Added a secrets injection block at the top of `streamlit_app.py` that reads `st.secrets` and sets env vars before importing agent modules. Locally, it's a no-op (`.env` handles it).
**Files modified:** `streamlit_app.py`

### Task 2: Missing Secrets Error Handling
**Question:** First deploy failed with `MissingAPIKeyError` — raw traceback shown to users.
**Solution:** Added validation after secrets injection. If keys are missing, the app shows a clear error message with the exact TOML format needed, instead of crashing.
**Files modified:** `streamlit_app.py`

### Task 3: Requirements Version Pinning
**Question:** `requirements.txt` had no version pins (issue #11) — risky for cloud deployment.
**Solution:** Added `>=` floor pins based on installed versions: `anthropic>=0.79.0`, `tavily-python>=0.7.21`, `streamlit>=1.54.0`, `python-dotenv>=1.2.0`.
**Decision:** Used `>=` (floor) instead of `==` (exact) — allows compatible updates while guaranteeing a known-good minimum.
**Files modified:** `requirements.txt`

### Task 4: Streamlit Cloud Deployment
**Question:** Deploy and get a live URL.
**Solution:** User deployed via share.streamlit.io, connected GitHub repo, configured secrets via dashboard. App is live.
**Files modified:** None (cloud config only)

### Task 5: Usage Tracking Discussion
**Question:** User wants to track what demo users input and save generated reports.
**Discussion:** Explored options (Google Sheets, Supabase, Firebase, built-in analytics). Recommended Supabase (free Postgres) as best fit — can store full report content, user inputs, timing, and search queries.
**Decision:** Deferred to v0.4. Supabase integration is the next planned feature.
**Files modified:** None

### Task 6: API Cost Exposure Discussion
**Question:** What happens when the public demo burns API credits?
**Answer:** ~$0.05–0.15 per run. Discussed rate limiting options (session limit, access code gate, Streamlit auth, daily cap). User deferred to future version.
**Files modified:** None

## Key Decisions Made
1. Secrets injection in `streamlit_app.py` (not modifying `agent.py`/`tools.py`) — keeps core modules unaware of Streamlit
2. Floor pins (`>=`) for requirements — balance between stability and flexibility
3. Supabase is the planned approach for usage tracking and report persistence (v0.4)
4. Rate limiting deferred — acceptable risk at current demo scale

## Related Files
- Iteration doc: [docs/iterations/v0.3-streamlit-ui.md](../iterations/v0.3-streamlit-ui.md)
- CHANGELOG: [CHANGELOG.md](../../CHANGELOG.md)
